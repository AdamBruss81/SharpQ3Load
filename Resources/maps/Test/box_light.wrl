#VRML V2.0 utf8 generated by Q3BSP 1.1 from maps\box_light
WorldInfo { title "maps\box_light" }

NavigationInfo { headlight TRUE avatarSize [0.25 1.3333 2 ]} 
#VRML V2.0 utf8

# q3effects.wrl V 1.0
# some Quake 3 shader effects emulation
# hg@x79.net
#
##### Effects Begin


#### global effects timer 
DEF	TIMER TimeSensor { loop	TRUE cycleInterval 1.0 }

# cycle through a list of texture
PROTO AnimMap
[
	eventIn	SFFloat set_fraction 
	field SFFloat frequency 1
	field MFNode textures [] 
	eventIn	SFTime set_time
]
{
	DEF SW Switch {	# not VRML 97, use Switch to select texture
		whichChoice	0
		choice IS textures
	}

	DEF S Script {
		
		eventIn	SFFloat set_fraction  IS set_fraction
		eventIn	SFTime set_time  IS set_time

		eventOut SFInt32 choice_changed  
		
		field SFFloat frequency IS frequency
		field MFNode textures IS textures

		url	"javascript:
		function set_fraction(f) 
		{

			f = f*frequency / textures.length;
			f-= Math.floor(f);
			f= f* textures.length;
			//print(f);
			choice_changed = f;
		}	
		function set_time(f) 
		{

			f = f*frequency / textures.length;
			f-= Math.floor(f);
			f= f* textures.length;
			//print(f);
			choice_changed = f;
		}	

		"

	}
	ROUTE  S.choice_changed	TO SW.whichChoice

}


# Contact Extension Node definitions 
EXTERNPROTO MultiTexture[
	exposedField SFBool materialColor
	exposedField SFBool materialAlpha
	exposedField MFString mode
	exposedField MFString type
	exposedField MFNode texture
	exposedField MFNode textureTransform
	exposedField MFInt32 textureOp
	exposedField SFColor color
	exposedField SFFloat alpha
	]
["urn:inet:blaxxun.com:node:MultiTexture","http://www.blaxxun.com/vrml/protos/nodes.wrl#MultiTexture","nodes.wrl#MultiTexture"]

EXTERNPROTO TextureCoordGen[
	exposedField SFString mode
	exposedField MFFloat parameter
	]
["urn:inet:blaxxun.com:node:TextureCoordGen","http://www.blaxxun.com/vrml/protos/nodes.wrl#TextureCoordGen","nodes.wrl#TextureCoordGen"]

EXTERNPROTO MultiTextureCoordinate[
	exposedField MFNode coord
	]
["urn:inet:blaxxun.com:node:MultiTextureCoordinate","http://www.blaxxun.com/vrml/protos/nodes.wrl#MultiTextureCoordinate","nodes.wrl#MultiTextureCoordinate"]

EXTERNPROTO DrawOp[
	exposedField MFInt32 op
	exposedField MFFloat args 
]
["urn:inet:blaxxun.com:node:DrawOp","http://www.blaxxun.com/vrml/protos/nodes.wrl#DrawOp","nodes.wrl#DrawOp"]

#tcmod scroll 0 2
#tcMod stretch sin 1.2 .8 0 1.5
#tcMod stretch sin 1.2 .8 0 1.5
#tcMod rotate 40
#tcMod scale 2 2
# tcMod turb 0 .1 0 .01

PROTO rgbgen [
	field SFFloat base 0
	field SFFloat amplitude 1
	field SFFloat phase	 0
	field SFFloat frequency 1

	eventIn	SFFloat set_fraction 
	eventOut SFColor color

]
{
	Script {

		eventIn	SFFloat set_fraction  IS set_fraction
		eventOut SFColor color IS color

		field SFFloat base IS base
		field SFFloat amplitude IS amplitude
		field SFFloat phase IS phase
		field SFFloat frequency	IS frequency

		directOutput TRUE

		url	"javascript:
		function rgbgen(f) {
			//<freq> 
			f*=frequency;
			f+=phase;

			// sine 
			y = base+amplitude*Math.sin(f*Math.PI*2);
			// triangle
			f= f-Math.floor(f);
			if (f<=0.5) f=f*2; else f = 1 - 2*(f-0.5);

			// saw sawtooth
			f=f;
			///Inversesawtooth
			//f=1.0-f;
			//Square
			//if (f<=0.5) f=1; else f = -1;
			//y=base+amplitude*f;
			color= new SFColor(y,y,y);
		}
		function set_fraction(f) 
		{
			rgbgen(f);
		}	

		"

	}

}

PROTO TcMod [

	field SFString mode ""

	field SFVec2f scale  1 1

	field SFFloat rotate 0
	field SFVec2f scroll 0 0

	field SFInt32 func -1
	field SFFloat base 0
	field SFFloat amplitude 1
	field SFFloat phase	 0
	field SFFloat frequency 1

	eventIn	SFFloat set_fraction 
	eventIn	SFTime set_time

]
{
	DEF TX TextureTransform {
	#	scale  IS scale
		center -0.5 -0.5
	}

	Script {
		directOutput TRUE
		field SFNode TX USE	TX 
		
		eventIn	SFFloat set_fraction  IS set_fraction
		eventIn	SFTime set_time  IS set_time


		field SFFloat angle IS rotate

		field SFVec2f scale IS scale

		field SFVec2f s IS scroll

		field SFInt32 func IS func
		field SFFloat base IS base
		field SFFloat amplitude IS amplitude
		field SFFloat phase IS phase
		field SFFloat frequency	IS frequency

		directOutput TRUE

		url	"javascript:
		// rotate <degrees per per second>
		function rotate(f) { 	TX.rotation = f * angle * Math.PI*2; }
		function scroll(f) 
		{ 
			 var x = s.x* f *scale.x;
			 //x = x-Math.floor(x);
			 var y = s.y* f *scale.y;
			 //y = y-Math.floor(y);

			 TX.translation.x=x;
			 TX.translation.y=y;

		}
		// stretch <func> <base> <amplitude> <phase> <frequency>
		
		function stretch(f) 
		{
			f*=frequency;
			f+=phase;
			f=f-Math.floor(f);
			
			if (func== 0) // sine 
				f = Math.sin(f*Math.PI*2);
			else if (func == 1) {// triangle
				if (f<=0.5) f=f*2; else f = 1 - 2*(f-0.5);
			} else if (func == 2) {// saw sawtooth
				f=f;
			} else if (func == 3) {///Inversesawtooth
				f=1.0-f;
			} else if (func == 4) {//Square
				if (f<=0.5) f=-1; else f = 1;
			}
			y=base+amplitude*f;
			TX.scale.x = y;
			TX.scale.y = y;
		}

		function set_fraction(f) 
		{
			if (angle!=0) rotate(f);
			if (func>=0) stretch(f);
			scroll(f);
		}	
		function set_time(f) 
		{
			TX.scale.x = 1.0/scale.x;
			TX.scale.y = 1.0/scale.y;

			if (angle!=0) rotate(f-Math.floor(f));
			if (func>=0) stretch(f);
			scroll(f-Browser.getWorldStartTime());
		}	
		"

	}

}
Switch {
	whichChoice	-1
	choice [
		DEF BLEND_ONE_ONE DrawOp { op [	  # equivalent TO ADD 
				1 0 # zwrite off
				2 4 # z-test le-equal 
				6 1 # blend enable 
				7 2 # src blend mode  ONE
				8 2 # dst blend mode  ONE
			]
		}
		DEF BLEND_RESET DrawOp { op [
				1 1   # zwrite on
				6 0   # blend enable off 
				7  6  # src blend mode
				8  5  # dst blend mode 
			]
		}
		# global Material Node
		DEF MAT Material {
			#diffuseColor 1 1 1 we have problems with lighting
			diffuseColor 0 0 0
			emissiveColor 0.3 0.3 0.3
		}

		DEF MAT-UNLIT Material {
			diffuseColor 0 0 0
			emissiveColor 0.5 0.5 0.5
		}


	]
}

## for global brightness control 
DEF SUNLIGHT DirectionalLight {
	color	1 1 1
	ambientIntensity	0.5
	intensity 0.5
	direction 1 1 1
	on FALSE
	
}

##### Effects End




Group {
children [
Shape {
appearance DEF A0 Appearance {
material USE MAT 
texture MultiTexture { materialColor TRUE texture [
DEF _T0 ImageTexture {
  url "box_lightlma00.png"
}
DEF _T1 ImageTexture {
  url "textures/base_wall/metaltech08final.jpg"
}
]mode ["DIFFUSE_ADD,SELECTARG2" "MODULATE" ]}}
geometry  IndexedFaceSet {
	ccw FALSE creaseAngle 3.14
	coordIndex [
	0,1,2,-1,
	3,1,0,-1,
	4,5,6,-1,
	6,5,7,-1,
	8,9,10,-1,
	10,9,11,-1,
	12,13,14,-1,
	14,13,15,-1,
	16,17,18,-1,
	19,17,16,-1,
	20,21,22,-1,
	23,21,20,-1]
coord Coordinate { point [
	-2.48889 1.6 -6.75556,-2.48889 -2.31111 -1.95556,-2.48889 -2.31111 -6.75556,-2.48889 1.6 -1.95556,
	-2.48889 -2.31111 -6.75556,-7.11111 -2.31111 -6.75556,-2.48889 1.6 -6.75556,-7.11111 1.6 -6.75556,
	-7.11111 1.6 -6.75556,-7.11111 1.6 -1.95556,-2.48889 1.6 -6.75556,-2.48889 1.6 -1.95556,
	-2.48889 -2.31111 -1.95556,-7.11111 -2.31111 -1.95556,-2.48889 -2.31111 -6.75556,-7.11111 -2.31111 -6.75556,
	-2.48889 1.6 -1.95556,-7.11111 -2.31111 -1.95556,-2.48889 -2.31111 -1.95556,-7.11111 1.6 -1.95556,
	-7.11111 1.6 -6.75556,-7.11111 -2.31111 -1.95556,-7.11111 1.6 -1.95556,-7.11111 -2.31111 -6.75556]}
texCoord  MultiTextureCoordinate { coord [
		TextureCoordinate { point [
	0.328125 0.910156,0.222656 0.996094,0.328125 0.996094,0.222656 0.910156,
	0.441406 0.996094,0.339844 0.996094,0.441406 0.910156,0.339844 0.910156,
	0.113281 0.890625,0.113281 0.996094,0.214844 0.890625,0.214844 0.996094,
	0.105469 0.996094,0.00390625 0.996094,0.105469 0.890625,0.00390625 0.890625,
	0.550781 0.910156,0.449219 0.996094,0.550781 0.996094,0.449219 0.910156,
	0.328125 0.910156,0.222656 0.996094,0.222656 0.910156,0.328125 0.996094]}
	TextureCoordinate { point [
	1.375 1.5625,-0.3125 0.1875,1.375 0.1875,-0.3125 1.5625,
	1.125 0.1875,-0.5 0.1875,1.125 1.5625,-0.5 1.5625,
	-0.5 1.375,-0.5 -0.3125,1.125 1.375,1.125 -0.3125,
	1.125 -0.3125,-0.5 -0.3125,1.125 1.375,-0.5 1.375,
	1.125 1.5625,-0.5 0.1875,1.125 0.1875,-0.5 1.5625,
	1.375 1.5625,-0.3125 0.1875,-0.3125 1.5625,1.375 0.1875	]}
]}
	color Color { color [
	0.180 0.180 0.180,0.184 0.184 0.184,0.165 0.165 0.165,0.208 0.208 0.208,
	0.176 0.176 0.176,0.184 0.184 0.184,0.196 0.196 0.196,0.204 0.204 0.204,
	0.145 0.145 0.145,0.165 0.165 0.165,0.137 0.137 0.137,0.161 0.161 0.161,
	0.165 0.165 0.165,0.173 0.173 0.173,0.145 0.145 0.145,0.153 0.153 0.153,
	0.200 0.200 0.200,0.184 0.184 0.184,0.176 0.176 0.176,0.208 0.208 0.208,
	0.180 0.180 0.180,0.184 0.184 0.184,0.208 0.208 0.208,0.165 0.165 0.165]}
  }
}
]}
DEF Entities Group {
children [
Viewpoint { position -3.73333 -1.24444 -3.37778 fieldOfView 1.0 jump TRUE orientation 0 1 0 0
	description "info_player_deathmatch" }
]}

DEF BoundingBoxes {
version 1
count 152
numsides 6
[0
0,2,6,7
]
[1
0,2
]
[2
0,2
]
[3
0,2
]
[4
0,1,2,3
]
[5
0,1,2,3,4,5
]
[6
0,6
]
[7
0
]
[8
0
]
[9
0,1
]
[10
0,1
]
[11
1,5
]
[12
0,6
]
[13
0
]
[14
0,1
]
[15
0,1
]
[16
1
]
[17
1,5
]
[18
0,6
]
[19
0
]
[20
0,1
]
[21
0,1
]
[22
1
]
[23
1,5
]
[24
0,6
]
[25
0,1
]
[26
0,1
]
[27
1
]
[28
1
]
[29
1,5
]
[30
0,1,6,8
]
[31
0,1,8
]
[32
1,8
]
[33
1,8
]
[34
1,8,9
]
[35
1,5,8,9
]
[36
2,6,7
]
[37
2
]
[38
2
]
[39
2,3
]
[40
2,3
]
[41
3,4,5
]
[42
6,7
]
[47
4,5
]
[48
6
]
[53
5
]
[54
6
]
[59
5
]
[60
6
]
[65
5
]
[66
6,8
]
[67
8
]
[68
8
]
[69
8,9
]
[70
8,9
]
[71
5,9
]
[72
2,7
]
[73
2
]
[74
2,3
]
[75
2,3
]
[76
3
]
[77
3,4
]
[78
6,7
]
[83
4,5
]
[84
6,7
]
[89
4,5
]
[90
6,7
]
[95
4,5
]
[96
6
]
[101
5
]
[102
6,8
]
[103
8
]
[104
8,9
]
[105
8,9
]
[106
9
]
[107
5,9
]
[108
2,7
]
[109
2
]
[110
2,3
]
[111
3
]
[112
3
]
[113
3,4
]
[114
7
]
[119
4
]
[120
7
]
[125
4
]
[126
6,7
]
[131
4,5
]
[132
6,7
]
[137
4,5
]
[138
6,8
]
[139
8
]
[140
8,9
]
[141
9
]
[142
9
]
[143
5,9
]
[144
2,7
]
[145
2,3
]
[146
2,3
]
[147
3
]
[148
3
]
[149
3,4
]
[150
7
]
[155
4
]
[156
7
]
[161
4
]
[162
7
]
[167
4
]
[168
6,7
]
[173
4,5
]
[174
6,7,8
]
[175
8,9
]
[176
8,9
]
[177
9
]
[178
9
]
[179
4,5,9
]
[180
2,3,7,11
]
[181
2,3,11
]
[182
3,11
]
[183
3,11
]
[184
3,10,11
]
[185
3,4,10,11
]
[186
7,11
]
[187
11
]
[188
11
]
[189
10,11
]
[190
10,11
]
[191
4,10
]
[192
7,11
]
[193
11
]
[194
10,11
]
[195
10,11
]
[196
10
]
[197
4,10
]
[198
7,11
]
[199
11
]
[200
10,11
]
[201
10,11
]
[202
10
]
[203
4,10
]
[204
7,11
]
[205
10,11
]
[206
10,11
]
[207
10
]
[208
10
]
[209
4,10
]
[210
6,7,8,9,10,11
]
[211
8,9,10,11
]
[212
9,10
]
[213
9,10
]
[214
9,10
]
[215
4,5,9,10
]
}